  version: '3.9'

  services:
    user_service:
      build: ./back-end_django/user_service
      ports:
        - "8000:8000"
      hostname: user-service
      networks:
        - app_net 

    amenity_service:
      build: ./back-end_django/amenity_service
      ports:
        - "8001:8001"
      hostname: amenity-service
      environment:
        - USER_AMENITY_SERVICE_URL=http://user-amenity-service:8002/api/user_amenities/
      networks:
        - app_net  

    user_amenity_service:
      build: ./back-end_django/user_amenity_service
      ports:
        - "8002:8002"
      environment:
        - USER_AMENITY_SERVICE_URL=http://user-amenity-service:8002/api/user_amenities/
      hostname: user-amenity-service
      networks:
        - app_net

    frontend:
      build: ./front-end
      ports:
        - "5173:5173"
      depends_on:
        - middleware
      networks:
        - app_net

    middleware:
      build: ./middleware
      ports:
        - "8080:8080"
      environment:
        - USER_SERVICE_URL=http://user-service:8000
        - AMENITY_SERVICE_URL=http://amenity-service:8001
        - USER_AMENITY_SERVICE_URL=http://user-amenity-service:8002
      depends_on:
        - user_service
        - amenity_service
        - user_amenity_service
      networks:
        - app_net
        

  networks:
    app_net:
      driver: bridge